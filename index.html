<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STE → WIM · 07:44</title>
<style>
  :root{
    --bg:#000;
    --white:#eaeaea;
    --green:#58d27a;   /* on time */
    --amber:#ffa000;   /* delayed */
    --red:#ff3b30;     /* cancelled */
    --mute:#9aa0a6;    /* brackets */
  }
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--white);
    display:grid; place-items:center; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  }
  .wrap{ text-align:center; }
  .route{
    font-weight:800; letter-spacing:.06em; margin-bottom:.6rem;
  }
  .time{
    font-weight:800; line-height:1.1;
  }
  /* responsive sizing */
  .route{ font-size: clamp(14px, 4vw, 28px); }
  .time { font-size: clamp(28px, 9vw, 64px); }
  .sub { font-size: clamp(12px, 3.5vw, 18px); opacity:.9; margin-top:.4rem }
  .strike{ text-decoration: line-through; }
  .green{ color:var(--green) }
  .amber{ color:var(--amber) }
  .red{ color:var(--red) }
  .mute{ color:var(--mute) }
</style>
</head>
<body>
<div class="wrap" id="app">Loading…</div>

<script>
const fmt = t => t ? t.slice(0,2)+":"+t.slice(2) : "—";
const mins = t => t ? (+t.slice(0,2))*60 + (+t.slice(2)) : null;

function render(data){
  const el = document.getElementById('app');
  if(data.error){ el.innerHTML = `<div class="route red">STE-WIM</div><div class="time red">Error</div>`; return; }

  const o = data.origin || {};
  const d = data.destination || {};
  const bookedDep = o.bookedDeparture || data.gbttBookedDeparture || null;
  const realDep   = o.realtimeDeparture || null;
  const bookedArr = d.bookedArrival || null;
  const realArr   = d.realtimeArrival || null;

  // Decide status
  let status = (data.status || "on_time");
  if (o?.isCancelled || d?.isCancelled) status = "cancelled";

  const headerClass =
    status === "cancelled" ? "red" :
    status === "delayed"   ? "amber" :
    status === "early"     ? "green" : ""; // route stays white when on time

  let bodyHTML = "";

  if(status === "cancelled"){
    bodyHTML = `<div class="time red"><span class="strike">${fmt(bookedDep)}</span> CANCELLED</div>`;
  } else if(status === "delayed" || status === "early"){
    const dep = realDep ? `<span class="amber">${fmt(realDep)}</span> <span class="mute">(${fmt(bookedDep)})</span>`
                        : `<span class="amber">${fmt(bookedDep)}</span>`;
    const arr = realArr ? `<span class="amber">${fmt(realArr)}</span> <span class="mute">(${fmt(bookedArr)})</span>`
                        : (bookedArr ? `<span class="amber">${fmt(bookedArr)}</span>` : "");
    bodyHTML = `<div class="time">${dep}${arr ? " <span class='mute'>-</span> "+arr : ""}</div>`;
  } else {
    // on time (or unknown -> treat as on time visual)
    const show = realDep || bookedDep;
    bodyHTML = `<div class="time green">${fmt(show)}</div>`;
  }

  // Optional tiny subline with platforms if you want (comment out if too busy)
  const sub = (o.platform || d.platform)
    ? `<div class="sub mute">${o.platform ? "Plat "+o.platform : ""}${o.platform&&d.platform ? " · " : ""}${d.platform ? "Plat "+d.platform : ""}</div>`
    : "";

  el.innerHTML = `
    <div class="route ${headerClass}">STE-WIM</div>
    ${bodyHTML}
    ${sub}
  `;
}

async function load(){
  try{
    const res = await fetch('./status.json?ts='+Date.now(), { cache: 'no-store' });
    if(!res.ok) throw new Error('status.json not found');
    const data = await res.json();
    render(data);
  }catch(e){
    render({ error:String(e) });
  }
}

load();
setInterval(load, 60000); // refresh every 60s
</script>
</body>
</html>
